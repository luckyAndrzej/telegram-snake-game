# Telegram Snake Game - –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–∞—è –∏–≥—Ä–∞ "–ó–º–µ–π–∫–∞"

–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–∞—è –∏–≥—Ä–∞ "–ó–º–µ–π–∫–∞" 1v1 –¥–ª—è Telegram Mini App –Ω–∞ Node.js + Socket.io + lowdb.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend:** Node.js + Express + Socket.io
- **Database:** lowdb (JSON —Ñ–∞–π–ª)
- **Frontend:** HTML5 + JavaScript + Canvas
- **Platform:** Telegram Mini App

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram_snake_game/
‚îú‚îÄ‚îÄ server.js              # –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (Node.js + Socket.io)
‚îú‚îÄ‚îÄ package.json           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js
‚îú‚îÄ‚îÄ Procfile              # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –¥–ª—è Railway
‚îú‚îÄ‚îÄ runtime.txt           # –í–µ—Ä—Å–∏—è Python (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ‚îÄ config.py             # Python –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ‚îÄ logger.py             # Python –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)
‚îÇ
‚îú‚îÄ‚îÄ db/                   # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ database.js       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è lowdb
‚îÇ   ‚îú‚îÄ‚îÄ users.js          # –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ db.json           # –§–∞–π–ª –ë–î (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ
‚îú‚îÄ‚îÄ game/                 # –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ gameLogic.js      # –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã (–∑–º–µ–π–∫–∏, —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è)
‚îÇ   ‚îî‚îÄ‚îÄ gameLoop.js       # –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª (15-20 —Ç–∏–∫–æ–≤/—Å–µ–∫)
‚îÇ
‚îú‚îÄ‚îÄ payment/              # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îî‚îÄ‚îÄ paymentHandler.js # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π (DEBUG vs TON)
‚îÇ
‚îî‚îÄ‚îÄ public/               # Frontend (Telegram Mini App)
    ‚îú‚îÄ‚îÄ index.html        # HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    ‚îú‚îÄ‚îÄ app.js            # JavaScript –∫–ª–∏–µ–Ω—Ç
    ‚îî‚îÄ‚îÄ styles.css        # –°—Ç–∏–ª–∏
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### DEBUG_MODE

–í —Ñ–∞–π–ª–µ `server.js` –Ω–∞ —Å—Ç—Ä–æ–∫–µ 18:

```javascript
const DEBUG_MODE = true; // true = –¢–µ—Å—Ç–æ–≤—ã–π, false = –ë–æ–µ–≤–æ–π (TON)
```

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:

#### üß™ DEBUG_MODE = true (–¢–µ—Å—Ç–æ–≤—ã–π):
- –ù–æ–≤—ã–º –∏–≥—Ä–æ–∫–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞–µ—Ç—Å—è **100 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∏–≥—Ä**
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏–º–∏—Ç–∏—Ä—É–µ—Ç—Å—è (–∫–Ω–æ–ø–∫–∞ –≤ UI)
- –ü—Ä–∏–∑—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- –ü–ª–∞—à–∫–∞ "TEST MODE" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

#### üí∞ DEBUG_MODE = false (–ë–æ–µ–≤–æ–π):
- –ù–æ–≤—ã–µ –∏–≥—Ä–æ–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç —Å **0 –∏–≥—Ä**
- –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ TON
- –ü—Ä–∏–∑—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –≤—ã–≤–æ–¥–∞
- –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (lowdb)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `db/db.json`:

```json
{
  "users": {
    "tg_id": {
      "tg_id": 123456789,
      "username": "username",
      "wallet": "",
      "games_balance": 100,
      "winnings_usdt": 0,
      "is_tester": true,
      "created_at": 1234567890
    }
  }
}
```

## üéÆ –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å

1. **–ü–æ–∏—Å–∫ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞:** –ò–≥—Ä–æ–∫ –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–π—Ç–∏ –∏–≥—Ä—É" ‚Üí —Å–µ—Ä–≤–µ—Ä –∏—â–µ—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞:** –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `games_balance >= 1` —É –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
3. **–°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:** –° –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è 1 –∏–≥—Ä–∞
4. **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** –û–±–∞ –∏–≥—Ä–æ–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Å–∏–≥–Ω–∞–ª `ready`
5. **–°—Ç–∞—Ä—Ç –∏–≥—Ä—ã:** Countdown 3 —Å–µ–∫—É–Ω–¥—ã ‚Üí –∏–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
6. **–ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª:** –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–≥—Ä—É **15 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É** —á–µ—Ä–µ–∑ Socket.io
7. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** –ü—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç `(1 * 2) * 0.75 = 1.5 USDT`

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
npm install
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
npm start
# –∏–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
npm run dev
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É **3000** (–∏–ª–∏ –∏–∑ `process.env.PORT`).

### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–ª—è Railway):

```env
PORT=3000                      # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Railway
TELEGRAM_BOT_TOKEN=...         # –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
WEB_APP_URL=https://...        # URL Mini App (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

## üì° API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### HTTP:

- `GET /api/user/:userId` - –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/add-games/:userId?amount=10` - –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å (—Ç–æ–ª—å–∫–æ DEBUG_MODE)

### WebSocket (Socket.io):

- `connect` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (auth: `{ user_id, username }`)
- `find_match` - –ü–æ–∏—Å–∫ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
- `ready` - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–≥—Ä–µ
- `direction` - –ö–æ–º–∞–Ω–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (`'up'`, `'down'`, `'left'`, `'right'`)
- `game_state` - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (broadcast –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
- `game_start` - –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
- `game_end` - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Server-Authoritative:** –í—Å—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **Real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** Socket.io broadcast –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–∞
- **–î–≤–∞ —Ä–µ–∂–∏–º–∞:** DEBUG (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ) –∏ PRODUCTION (TON)
- **lowdb:** –ü—Ä–æ—Å—Ç–∞—è JSON –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ Redis/PostgreSQL)

## üîÑ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –±–æ–µ–≤–æ–π —Ä–µ–∂–∏–º

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `DEBUG_MODE = false` –≤ `server.js`
2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ `payment/paymentHandler.js`
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ TON API
4. –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å" –∏–∑ UI

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –§–∞–π–ª `config.py` –∏ `logger.py` —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (Python –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó)
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Node.js –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å Python —Ñ–∞–π–ª—ã
- `Procfile` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è Railway: `web: node server.js`
